'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.getStandardFunctions = exports.getFunctions = void 0;
const tslib_1 = require("tslib");
const reduce_1 = tslib_1.__importDefault(require("lodash/reduce"));
const sliced_1 = tslib_1.__importDefault(require("sliced"));
const node_1 = require("./node");
// create a function that creates a function call of the specific name, using the specified sql instance
const getFunctionCallCreator = (name) => {
    return (...args) => {
        // turn array-like arguments object into a true array
        return new node_1.FunctionCallNode(name, sliced_1.default(args));
    };
};
// creates a hash of functions for a sql instance
const getFunctions = (functionNames) => {
    if (typeof functionNames === 'string') {
        return getFunctionCallCreator(functionNames);
    }
    const functions = reduce_1.default(functionNames, (reducer, name) => {
        reducer[name] = getFunctionCallCreator(name);
        return reducer;
    }, {});
    return functions;
};
exports.getFunctions = getFunctions;
// aggregate functions available to all databases
const aggregateFunctions = ['AVG', 'COUNT', 'DISTINCT', 'MAX', 'MIN', 'SUM'];
// common scalar functions available to most databases
const scalarFunctions = [
    'ABS',
    'COALESCE',
    'LEFT',
    'LENGTH',
    'LOWER',
    'LTRIM',
    'RANDOM',
    'RIGHT',
    'ROUND',
    'RTRIM',
    'SUBSTR',
    'TRIM',
    'UPPER'
];
const dateFunctions = ['YEAR', 'MONTH', 'DAY', 'HOUR', 'CURRENT_TIMESTAMP'];
// hstore function available to Postgres
const hstoreFunctions = ['HSTORE'];
// text search functions available to Postgres
const textsearchFunctions = ['TS_RANK', 'TS_RANK_CD', 'PLAINTO_TSQUERY', 'TO_TSQUERY', 'TO_TSVECTOR', 'SETWEIGHT'];
// jsonb functions available to postgres
const jsonbFunctions = [
    'JSONB_ARRAY_LENGTH',
    'JSONB_BUILD_ARRAY',
    'JSONB_BUILD_OBECT',
    'JSONB_EXTRACT_PATH',
    'JSONB_INSERT',
    'JSONB_OBJECT',
    'JSONB_PRETTY',
    'JSONB_SET',
    'JSONB_STRIP_NULLS',
    'JSONB_TYPEOF',
    'TO_JSONB',
    'JSONB_ARRAY_ELEMENTS',
    'JSONB_ARRAY_ELEMENTS_TEXT',
    'JSONB_EACH',
    'JSONB_EACH_TEXT',
    'JSONB_OBJECT_KEYS',
    'JSONB_AGG'
];
const standardFunctionNames = [
    ...aggregateFunctions,
    ...scalarFunctions,
    ...hstoreFunctions,
    ...textsearchFunctions,
    ...dateFunctions,
    ...jsonbFunctions
];
// creates a hash of standard functions for a sql instance
const getStandardFunctions = () => {
    return getFunctions(standardFunctionNames);
};
exports.getStandardFunctions = getStandardFunctions;
//# sourceMappingURL=functions.js.map